
<html>
    <head>
      <title>Уведомление</title>
      {% comment %} <script src="{% static '/channels/js/websocketbridge.js' %}" type="text/javascript"></script> {% endcomment %}
    </head>
    <body>
      <h1>Уведомление Заявок</h1>
      <p>Notifications</p>
      <ul id="notifylist"></ul>
      <h2>{{ id_ad }}</h2>
      <script>
          const webSocketBridge = new WebSocket(
                  'ws://'
                  + window.location.host
                  + `/ws/notification/bid/{{id_ad}}/`
                  
          );
          const nl = document.querySelector("#notifylist");
        
  
          webSocketBridge.onmessage = function(e) { // { type: "user.gossip", event: "New User", username: "Vlad134346" }
              const data = JSON.parse(e.data);
              console.log('data ---> ', data)
              author_ad = data.message_to_room.ad['author-ad']['username']
              console.log('author_ad --> ', author_ad)
              author_bid = data.message_to_room['bid']['author-bid']['username']
              console.log('author_bid --> ', author_bid)
              if (data.message_to_room.event == "Create bid" && author_ad === "{{user.username}}") {
                var el = document.createElement("li");
                el.innerHTML = `Заявка от пользователя ${author_bid}`;
                nl.appendChild(el);
              }
          };
      </script>
    </body>
  </html>